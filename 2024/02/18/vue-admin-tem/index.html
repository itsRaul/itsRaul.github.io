<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="vue," />










<meta name="description" content="Vue3 的中后台管理系统基础建设">
<meta name="keywords" content="vue">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue3 的中后台管理系统基础建设">
<meta property="og:url" content="http://yoursite.com/2024/02/18/vue-admin-tem/index.html">
<meta property="og:site_name" content="刘付鹏的个人网站">
<meta property="og:description" content="Vue3 的中后台管理系统基础建设">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2024-02-18T14:58:06.460Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Vue3 的中后台管理系统基础建设">
<meta name="twitter:description" content="Vue3 的中后台管理系统基础建设">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2024/02/18/vue-admin-tem/"/>





  <title>Vue3 的中后台管理系统基础建设 | 刘付鹏的个人网站</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">刘付鹏的个人网站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Personal Website</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/02/18/vue-admin-tem/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘付鹏">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘付鹏的个人网站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Vue3 的中后台管理系统基础建设</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-02-18T22:54:47+08:00">
                2024-02-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/vue/" itemprop="url" rel="index">
                    <span itemprop="name">vue</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="Vue3-的中后台管理系统基础建设"><a href="#Vue3-的中后台管理系统基础建设" class="headerlink" title="Vue3 的中后台管理系统基础建设"></a>Vue3 的中后台管理系统基础建设</h3><a id="more"></a>
<h4 id="vue-cli-创建项目"><a href="#vue-cli-创建项目" class="headerlink" title="vue-cli 创建项目"></a>vue-cli 创建项目</h4><p>如果你需要升级版本，那么可以通过以下指令进行升级：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm update -g @vue/cli</span><br></pre></td></tr></table></figure>
<p>终端输入 <code>vue create 项目名称</code> ，即可进入 <strong>模板选择</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 利用 vue-cli 创建项目</span></span><br><span class="line">vue create imooc-admin</span><br><span class="line"><span class="comment">// 进入模板选择</span></span><br><span class="line">Vue CLI v4<span class="number">.5</span><span class="number">.13</span></span><br><span class="line">? Please pick a preset:</span><br><span class="line">  Default ([Vue <span class="number">2</span>] babel, eslint)</span><br><span class="line">  Default (Vue <span class="number">3</span>) ([Vue <span class="number">3</span>] babel, eslint)</span><br><span class="line">&gt; Manually select features  <span class="comment">// 选择手动配置</span></span><br><span class="line"><span class="comment">// ----------------------------------------------------------</span></span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project:</span><br><span class="line"> (*) Choose Vue version <span class="comment">// 选择 vue 版本</span></span><br><span class="line"> (*) Babel <span class="comment">// 使用 babel</span></span><br><span class="line"> ( ) TypeScript <span class="comment">// 不使用 ts</span></span><br><span class="line"> ( ) Progressive Web App (PWA) Support <span class="comment">// 不使用 PWA</span></span><br><span class="line"> (*) Router <span class="comment">// 添加 vue-router</span></span><br><span class="line"> (*) Vuex <span class="comment">// 添加 vuex</span></span><br><span class="line">&gt;(*) CSS Pre-processors <span class="comment">// 使用 css 预处理器</span></span><br><span class="line"> (*) Linter / Formatter <span class="comment">// 代码格式化</span></span><br><span class="line"> ( ) Unit Testing <span class="comment">// 不配置测试</span></span><br><span class="line"> ( ) E2E Testing  <span class="comment">// // 不配置测试</span></span><br><span class="line"><span class="comment">// ----------------------------------------------------------</span></span><br><span class="line"> Choose a version <span class="keyword">of</span> Vue.js that you want to start the project <span class="keyword">with</span></span><br><span class="line">  <span class="number">2.</span>x</span><br><span class="line">&gt; <span class="number">3.</span>x <span class="comment">// 选择 vue 3.0 版本</span></span><br><span class="line"><span class="comment">// ----------------------------------------------------------</span></span><br><span class="line"> Use history mode <span class="keyword">for</span> router? (Requires proper server setup <span class="keyword">for</span> index fallback <span class="keyword">in</span> production) (Y/n) n <span class="comment">// 不使用 history模式 的路由</span></span><br><span class="line"><span class="comment">// ----------------------------------------------------------</span></span><br><span class="line"> ? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by <span class="keyword">default</span>):</span><br><span class="line">&gt; Sass/SCSS (<span class="keyword">with</span> dart-sass) <span class="comment">// 使用基于 dart-sass 的 scss 预处理器</span></span><br><span class="line">  Sass/SCSS (<span class="keyword">with</span> node-sass)</span><br><span class="line">  Less</span><br><span class="line">  Stylus</span><br><span class="line"><span class="comment">// ----------------------------------------------------------</span></span><br><span class="line">? Pick a linter / formatter config:</span><br><span class="line">  ESLint <span class="keyword">with</span> error prevention only</span><br><span class="line">  ESLint + Airbnb config</span><br><span class="line">&gt; ESLint + Standard config <span class="comment">// 使用 ESLint 标准代码格式化方案</span></span><br><span class="line">  ESLint + Prettier</span><br><span class="line"><span class="comment">// ----------------------------------------------------------</span></span><br><span class="line">? Pick additional lint features:</span><br><span class="line"> (*) Lint on save <span class="comment">//</span></span><br><span class="line">&gt;(*) Lint and fix on commit  <span class="comment">// 保存时 &amp;&amp; 提交时，都进行 lint</span></span><br><span class="line"><span class="comment">// ----------------------------------------------------------</span></span><br><span class="line">? Where <span class="keyword">do</span> you prefer placing config <span class="keyword">for</span> Babel, ESLint, etc.? (Use arrow keys)</span><br><span class="line">&gt; In dedicated config files <span class="comment">// 单独的配置文件</span></span><br><span class="line">  In package.json</span><br><span class="line"><span class="comment">// ----------------------------------------------------------</span></span><br><span class="line"> Save <span class="keyword">this</span> <span class="keyword">as</span> a preset <span class="keyword">for</span> future projects? (y/N) n <span class="comment">// 不存储预设</span></span><br></pre></td></tr></table></figure>
<h4 id="代码规范"><a href="#代码规范" class="headerlink" title="代码规范"></a>代码规范</h4><h5 id="eslint"><a href="#eslint" class="headerlink" title="eslint"></a>eslint</h5><p><code>.eslintrc.js</code> 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  root: <span class="literal">true</span>,</span><br><span class="line">  env: &#123;</span><br><span class="line">    node: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  extends: [<span class="string">"plugin:vue/vue3-essential"</span>, <span class="string">"@vue/standard"</span>],</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    parser: <span class="string">"@babel/eslint-parser"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 错误级别分为三种：</span></span><br><span class="line"><span class="comment">   * "off" 或 0 - 关闭规则</span></span><br><span class="line"><span class="comment">   * "warn" 或 1 - 开启规则，使用警告级别的错误：warn (不会导致程序退出)</span></span><br><span class="line"><span class="comment">   * "error" 或 2 - 开启规则，使用错误级别的错误：error (当被触发的时候，程序会退出)</span></span><br><span class="line"><span class="comment">   * space-before-function-paren表示关闭《方法名后增加空格》的规则</span></span><br><span class="line"><span class="comment">   * vue/multi-word-component-names vue文件名关闭</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="string">"no-console"</span>: process.env.NODE_ENV === <span class="string">"production"</span> ? <span class="string">"warn"</span> : <span class="string">"off"</span>,</span><br><span class="line">    <span class="string">"no-debugger"</span>: process.env.NODE_ENV === <span class="string">"production"</span> ? <span class="string">"warn"</span> : <span class="string">"off"</span>,</span><br><span class="line">    <span class="string">"space-before-function-paren"</span>: <span class="string">"off"</span>,</span><br><span class="line">    <span class="string">"vue/multi-word-component-names"</span>: <span class="string">"off"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="prettier-代码格式化"><a href="#prettier-代码格式化" class="headerlink" title="prettier 代码格式化"></a>prettier 代码格式化</h5><ol>
<li><p>在 <code>VSCode</code> 中安装 <code>prettier</code> 插件。</p>
</li>
<li><p>在项目中新建 <code>.prettierrc</code> 文件，该文件为 <code>perttier</code> 默认配置文件</p>
</li>
<li><p>在该文件中写入如下配置：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  // 不尾随分号</span><br><span class="line">  "semi": false,</span><br><span class="line">  // 使用单引号</span><br><span class="line">  "singleQuote": true,</span><br><span class="line">  // 多行逗号分割的语法中，最后一行不加逗号</span><br><span class="line">  "trailingComma": "none"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>打开 <code>VSCode</code> 《设置面板》， 搜索 save，勾选 <code>Format On Save</code>。</p>
</li>
</ol>
<h5 id="git-提交规范"><a href="#git-提交规范" class="headerlink" title="git 提交规范"></a>git 提交规范</h5><blockquote>
<p>使用较多的 <a href="https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#-git-commit-guidelines" target="_blank" rel="noopener">Angular 团队规范</a> 延伸出的 <a href="https://www.conventionalcommits.org/zh-hans/v1.0.0/" target="_blank" rel="noopener">Conventional Commits specification（约定式提交）</a> <strong><code>git</code> 提交规范</strong></p>
</blockquote>
<ol>
<li>约定式提交规范要求如下：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;type&gt;[optional scope]: &lt;description&gt;</span><br><span class="line"></span><br><span class="line">[optional body]</span><br><span class="line"></span><br><span class="line">[optional footer(s)]</span><br><span class="line"></span><br><span class="line">--------  翻译 -------------</span><br><span class="line"></span><br><span class="line">&lt;类型&gt;[可选 范围]: &lt;描述&gt;</span><br><span class="line"></span><br><span class="line">[可选 正文]</span><br><span class="line"></span><br><span class="line">[可选 脚注]</span><br></pre></td></tr></table></figure>
<ol>
<li><p>全局安装<code>Commitizen</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g commitizen@<span class="number">4.2</span><span class="number">.4</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>安装并配置 <code>cz-customizable</code> 插件</p>
<ol>
<li><p>使用 <code>npm</code> 下载 <code>cz-customizable</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i cz-customizable@6.3.0 --save-dev</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加以下配置到 <code>package.json</code> 中</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  "config": &#123;</span><br><span class="line">    "commitizen": &#123;</span><br><span class="line">      "path": "node_modules/cz-customizable"</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>项目根目录下创建 <code>.cz-config.js</code> 自定义提示文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// 可选类型</span></span><br><span class="line">  types: [</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">"feat"</span>, <span class="attr">name</span>: <span class="string">"feat:     新功能"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">"fix"</span>, <span class="attr">name</span>: <span class="string">"fix:      修复"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">"docs"</span>, <span class="attr">name</span>: <span class="string">"docs:     文档变更"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">"style"</span>, <span class="attr">name</span>: <span class="string">"style:    代码格式(不影响代码运行的变动)"</span> &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      value: <span class="string">"refactor"</span>,</span><br><span class="line">      name: <span class="string">"refactor: 重构(既不是增加feature，也不是修复bug)"</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">"perf"</span>, <span class="attr">name</span>: <span class="string">"perf:     性能优化"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">"test"</span>, <span class="attr">name</span>: <span class="string">"test:     增加测试"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">"chore"</span>, <span class="attr">name</span>: <span class="string">"chore:    构建过程或辅助工具的变动"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">"revert"</span>, <span class="attr">name</span>: <span class="string">"revert:   回退"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">"build"</span>, <span class="attr">name</span>: <span class="string">"build:    打包"</span> &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 消息步骤</span></span><br><span class="line">  messages: &#123;</span><br><span class="line">    type: <span class="string">"请选择提交类型:"</span>,</span><br><span class="line">    customScope: <span class="string">"请输入修改范围(可选):"</span>,</span><br><span class="line">    subject: <span class="string">"请简要描述提交(必填):"</span>,</span><br><span class="line">    body: <span class="string">"请输入详细描述(可选):"</span>,</span><br><span class="line">    footer: <span class="string">"请输入要关闭的issue(可选):"</span>,</span><br><span class="line">    confirmCommit: <span class="string">"确认使用以上信息提交？(y/n/e/h)"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 跳过问题</span></span><br><span class="line">  skipQuestions: [<span class="string">"body"</span>, <span class="string">"footer"</span>],</span><br><span class="line">  <span class="comment">// subject文字长度默认是72</span></span><br><span class="line">  subjectLimit: <span class="number">72</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 <code>git cz</code> 代替 <code>git commit</code><br>使用 <code>git cz</code> 代替 <code>git commit</code>，即可看到提示内容</p>
</li>
<li><p>安装依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev @commitlint/config-conventional@12.1.4 @commitlint/cli@12.1.4</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建 <code>commitlint.config.js</code> 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;module.exports = &#123;extends: [&apos;@commitlint/config-conventional&apos;]&#125;&quot; &gt; commitlint.config.js</span><br></pre></td></tr></table></figure>
</li>
<li><p>打开 <code>commitlint.config.js</code> ， 增加配置项（ <a href="https://github.com/conventional-changelog/commitlint/blob/master/@commitlint/config-conventional/index.js" target="_blank" rel="noopener">config-conventional 默认配置点击可查看</a> ）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// 继承的规则</span></span><br><span class="line">  extends: [<span class="string">"@commitlint/config-conventional"</span>],</span><br><span class="line">  <span class="comment">// 定义规则类型</span></span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="comment">// type 类型定义，表示 git 提交的 type 必须在以下类型范围内</span></span><br><span class="line">    <span class="string">"type-enum"</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      <span class="string">"always"</span>,</span><br><span class="line">      [</span><br><span class="line">        <span class="string">"feat"</span>, <span class="comment">// 新功能 feature</span></span><br><span class="line">        <span class="string">"fix"</span>, <span class="comment">// 修复 bug</span></span><br><span class="line">        <span class="string">"docs"</span>, <span class="comment">// 文档注释</span></span><br><span class="line">        <span class="string">"style"</span>, <span class="comment">// 代码格式(不影响代码运行的变动)</span></span><br><span class="line">        <span class="string">"refactor"</span>, <span class="comment">// 重构(既不增加新功能，也不是修复bug)</span></span><br><span class="line">        <span class="string">"perf"</span>, <span class="comment">// 性能优化</span></span><br><span class="line">        <span class="string">"test"</span>, <span class="comment">// 增加测试</span></span><br><span class="line">        <span class="string">"chore"</span>, <span class="comment">// 构建过程或辅助工具的变动</span></span><br><span class="line">        <span class="string">"revert"</span>, <span class="comment">// 回退</span></span><br><span class="line">        <span class="string">"build"</span>, <span class="comment">// 打包</span></span><br><span class="line">      ],</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// subject 大小写不做校验</span></span><br><span class="line">    <span class="string">"subject-case"</span>: [<span class="number">0</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install husky@7.0.1 --save-dev</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动 <code>hooks</code> ， 生成 <code>.husky</code> 文件夹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx husky install</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 <code>package.json</code> 中生成 <code>prepare</code> 指令（ <strong>需要 npm &gt; 7.0 版本</strong> ）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm set-script prepare &quot;husky install&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行 <code>prepare</code> 指令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run prepare</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行成功</p>
</li>
<li><p>添加 <code>commitlint</code> 的 <code>hook</code> 到 <code>husky</code>中，并指令在 <code>commit-msg</code> 的 <code>hooks</code> 下执行 <code>npx --no-install commitlint --edit &quot;$1&quot;</code> 指令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx husky add .husky/commit-msg &apos;npx --no-install commitlint --edit &quot;$1&quot;&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改 <code>package.json</code> 配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"lint-staged"</span>: &#123;</span><br><span class="line">    <span class="string">"src/**/*.&#123;js,vue&#125;"</span>: [</span><br><span class="line">      <span class="string">"eslint --fix"</span>,</span><br><span class="line">      <span class="string">"git add"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">15. 修改 `.husky/pre-commit` 文件</span><br><span class="line"></span><br><span class="line">  ```js</span><br><span class="line">  #!/bin/sh</span><br><span class="line">  . &quot;$(dirname &quot;$0&quot;)/_/husky.sh&quot;</span><br><span class="line"></span><br><span class="line">  npx lint-staged</span><br></pre></td></tr></table></figure>
<h4 id="svg-组件开发"><a href="#svg-组件开发" class="headerlink" title="svg 组件开发"></a>svg 组件开发</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    v-if=&quot;isExternal&quot;</span><br><span class="line">    :style=&quot;styleExternalIcon&quot;</span><br><span class="line">    class=&quot;svg-external-icon svg-icon&quot;</span><br><span class="line">    :class=&quot;className&quot;</span><br><span class="line">  /&gt;</span><br><span class="line">  &lt;svg v-else class=&quot;svg-icon&quot; :class=&quot;className&quot; aria-hidden=&quot;true&quot;&gt;</span><br><span class="line">    &lt;use :xlink:href=&quot;iconName&quot; /&gt;</span><br><span class="line">  &lt;/svg&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; isExternal as external &#125; from &quot;@/utils/validate&quot;;</span><br><span class="line">import &#123; defineProps, computed &#125; from &quot;vue&quot;;</span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  // icon 图标</span><br><span class="line">  icon: &#123;</span><br><span class="line">    type: String,</span><br><span class="line">    required: true,</span><br><span class="line">  &#125;,</span><br><span class="line">  // 图标类名</span><br><span class="line">  className: &#123;</span><br><span class="line">    type: String,</span><br><span class="line">    default: &quot;&quot;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 判断是否为外部图标</span><br><span class="line"> */</span><br><span class="line">const isExternal = computed(() =&gt; external(props.icon));</span><br><span class="line">/**</span><br><span class="line"> * 外部图标样式</span><br><span class="line"> */</span><br><span class="line">const styleExternalIcon = computed(() =&gt; (&#123;</span><br><span class="line">  mask: `url($&#123;props.icon&#125;) no-repeat 50% 50%`,</span><br><span class="line">  &quot;-webkit-mask&quot;: `url($&#123;props.icon&#125;) no-repeat 50% 50%`,</span><br><span class="line">&#125;));</span><br><span class="line">/**</span><br><span class="line"> * 项目内图标</span><br><span class="line"> */</span><br><span class="line">const iconName = computed(() =&gt; `#icon-$&#123;props.icon&#125;`);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.svg-icon &#123;</span><br><span class="line">  width: 1em;</span><br><span class="line">  height: 1em;</span><br><span class="line">  vertical-align: -0.15em;</span><br><span class="line">  fill: currentColor;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.svg-external-icon &#123;</span><br><span class="line">  background-color: currentColor;</span><br><span class="line">  mask-size: cover !important;</span><br><span class="line">  display: inline-block;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>创建 <code>utils/validate.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断是否为外部资源</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isExternal</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/^(https?:|mailto:|tel:)/</span>.test(path);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 <code>views/login/index.vue</code> 中使用 <strong>外部 <code>svg</code> （<code>https://res.lgdsunday.club/user.svg</code>）：</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"svg-container"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">svg-icon</span> <span class="attr">icon</span>=<span class="string">"https://res.lgdsunday.club/user.svg"</span>&gt;</span><span class="tag">&lt;/<span class="name">svg-icon</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>icons 文件下 index.js 代码：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SvgIcon <span class="keyword">from</span> <span class="string">"@/components/SvgIcon"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 require.context() 函数来创建自己的 context</span></span><br><span class="line"><span class="keyword">const</span> svgRequire = <span class="built_in">require</span>.context(<span class="string">"./svg"</span>, <span class="literal">false</span>, /\.svg$/);</span><br><span class="line"><span class="comment">// 此时返回一个 require 的函数，可以接受一个 request 的参数，用于 require 的导入。</span></span><br><span class="line"><span class="comment">// 该函数提供了三个属性，可以通过 require.keys() 获取到所有的 svg 图标</span></span><br><span class="line"><span class="comment">// 遍历图标，把图标作为 request 传入到 require 导入函数中，完成本地 svg 图标的导入</span></span><br><span class="line">svgRequire.keys().forEach(<span class="function">(<span class="params">svgIcon</span>) =&gt;</span> svgRequire(svgIcon));</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (app) =&gt; &#123;</span><br><span class="line">  app.component(<span class="string">"svg-icon"</span>, SvgIcon);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>在 <code>main.js</code> 中引入该文件</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// 导入 svgIcon</span></span><br><span class="line"><span class="keyword">import</span> installIcons <span class="keyword">from</span> <span class="string">'@/icons'</span></span><br><span class="line">...</span><br><span class="line">installIcons(app)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="axios-封装"><a href="#axios-封装" class="headerlink" title="axios 封装"></a>axios 封装</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">"axios"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ElMessage &#125; <span class="keyword">from</span> <span class="string">"element-plus"</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"@/store"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isCheckTimeOut &#125; <span class="keyword">from</span> <span class="string">"@/utils/auth"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> service = axios.create(&#123;</span><br><span class="line">  baseURL: process.env.VUE_APP_BASE_API,</span><br><span class="line">  timeout: <span class="number">5000</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line">service.interceptors.request.use(</span><br><span class="line">  (config) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 在这个位置需要统一的去注入token</span></span><br><span class="line">    <span class="keyword">if</span> (store.getters.token) &#123;</span><br><span class="line">      <span class="comment">// 时效 token处理</span></span><br><span class="line">      <span class="keyword">if</span> (isCheckTimeOut()) &#123;</span><br><span class="line">        store.dispatch(<span class="string">"user/logout"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"token失效"</span>));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 如果token存在 注入token</span></span><br><span class="line">      config.headers.Authorization = <span class="string">`Bearer <span class="subst">$&#123;store.getters.token&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config; <span class="comment">// 必须返回配置</span></span><br><span class="line">  &#125;,</span><br><span class="line">  (error) =&gt; &#123;</span><br><span class="line">    <span class="comment">// token超时问题，根据后端接口定义的code值进行判断</span></span><br><span class="line">    <span class="comment">// if (error.data.code === 401) &#123;&#125;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">service.interceptors.response.use(</span><br><span class="line">  (response) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; success, message, data &#125; = response.data;</span><br><span class="line">    <span class="comment">//   要根据success的成功与否决定下面的操作</span></span><br><span class="line">    <span class="keyword">if</span> (success) &#123;</span><br><span class="line">      <span class="keyword">return</span> data;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 业务错误</span></span><br><span class="line">      ElMessage.error(message); <span class="comment">// 提示错误消息</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(message));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  (error) =&gt; &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 将来处理 token 超时问题</span></span><br><span class="line">    ElMessage.error(error.message); <span class="comment">// 提示错误信息</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service;</span><br></pre></td></tr></table></figure>
<ol>
<li>在用户登陆时，记录当前 <strong>登录时间</strong></li>
<li>制定一个 <strong>失效时长</strong></li>
<li>在接口调用时，根据 <strong>当前时间</strong> 对比 <strong>登录时间</strong> ，看是否超过了 <strong>时效时长</strong><ol>
<li>如果未超过，则正常进行后续操作</li>
<li>如果超过，则进行 <strong>退出登录</strong> 操作</li>
</ol>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; TIME_STAMP, TOKEN_TIMEOUT_VALUE &#125; <span class="keyword">from</span> <span class="string">"@/constant"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; setItem, getItem &#125; <span class="keyword">from</span> <span class="string">"@/utils/storage"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取时间戳</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getTimeStamp</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> getItem(TIME_STAMP);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置时间戳</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setTimeStamp</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> setItem(TIME_STAMP, <span class="built_in">Date</span>.now());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否超时</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isCheckTimeOut</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 当前时间戳</span></span><br><span class="line">  <span class="keyword">const</span> currentTime = <span class="built_in">Date</span>.now();</span><br><span class="line">  <span class="comment">// 缓存时间戳</span></span><br><span class="line">  <span class="keyword">const</span> timeStamp = getTimeStamp();</span><br><span class="line">  <span class="keyword">return</span> currentTime - timeStamp &gt; TOKEN_TIMEOUT_VALUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="面包屑结构数据"><a href="#面包屑结构数据" class="headerlink" title="面包屑结构数据"></a>面包屑结构数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-breadcrumb class=&quot;breadcrumb&quot; separator=&quot;/&quot;&gt;</span><br><span class="line">    &lt;transition-group name=&quot;breadcrumb&quot;&gt;</span><br><span class="line">      &lt;el-breadcrumb-item</span><br><span class="line">        v-for=&quot;(item, index) in breadcrumbData&quot;</span><br><span class="line">        :key=&quot;item.path&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!-- 不可点击项 --&gt;</span><br><span class="line">        &lt;span v-if=&quot;index === breadcrumbData.length - 1&quot; class=&quot;no-redirect&quot;&gt;&#123;&#123;</span><br><span class="line">          generateTitle(item.meta.title)</span><br><span class="line">        &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;!-- 可点击项 --&gt;</span><br><span class="line">        &lt;a v-else class=&quot;redirect&quot; @click.prevent=&quot;onLinkClick(item)&quot;&gt;&#123;&#123;</span><br><span class="line">          generateTitle(item.meta.title)</span><br><span class="line">        &#125;&#125;&lt;/a&gt;</span><br><span class="line">      &lt;/el-breadcrumb-item&gt;</span><br><span class="line">    &lt;/transition-group&gt;</span><br><span class="line">  &lt;/el-breadcrumb&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; generateTitle &#125; from &quot;@/utils/i18n&quot;;</span><br><span class="line">import &#123; ref, watch &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; useRoute, useRouter &#125; from &quot;vue-router&quot;;</span><br><span class="line">import &#123; useStore &#125; from &quot;vuex&quot;;</span><br><span class="line"></span><br><span class="line">// generateTitle国际化处理title</span><br><span class="line"></span><br><span class="line">const route = useRoute();</span><br><span class="line">// 生成数组数据</span><br><span class="line">const breadcrumbData = ref([]);</span><br><span class="line">const getBreadcrumbData = () =&gt; &#123;</span><br><span class="line">  breadcrumbData.value = route.matched.filter(</span><br><span class="line">    (item) =&gt; item.meta &amp;&amp; item.meta.title</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line">// 监听路由变化时触发</span><br><span class="line">watch(</span><br><span class="line">  route,</span><br><span class="line">  () =&gt; &#123;</span><br><span class="line">    getBreadcrumbData();</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    immediate: true,</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">// 处理点击事件</span><br><span class="line">const router = useRouter();</span><br><span class="line">const onLinkClick = (item) =&gt; &#123;</span><br><span class="line">  router.push(item.path);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 将来需要进行主题替换，所以这里获取下动态样式</span><br><span class="line">const store = useStore();</span><br><span class="line">// eslint-disable-next-line</span><br><span class="line">const linkHoverColor = ref(store.getters.cssVar.menuBg);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.breadcrumb &#123;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  font-size: 14px;</span><br><span class="line">  line-height: 50px;</span><br><span class="line">  margin-left: 8px;</span><br><span class="line"></span><br><span class="line">  .no-redirect &#123;</span><br><span class="line">    color: #97a8be;</span><br><span class="line">    cursor: text;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .redirect &#123;</span><br><span class="line">    color: #666;</span><br><span class="line">    font-weight: 600;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .redirect:hover &#123;</span><br><span class="line">    // 将来需要进行主题替换，所以这里不去写死样式</span><br><span class="line">    color: v-bind(linkHoverColor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h4 id="国际化-vue-i18n"><a href="#国际化-vue-i18n" class="headerlink" title="国际化 vue-i18n"></a>国际化 vue-i18n</h4><blockquote>
<p>vue3 下需要使用 V 9.x 的 i18n</p>
</blockquote>
<ol>
<li><p>安装 <code>vue-i18n</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue-i18n@next</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建 <code>i18n/index.js</code> 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createI18n &#125; <span class="keyword">from</span> <span class="string">"vue-i18n"</span>;</span><br><span class="line"><span class="keyword">import</span> mZhLocale <span class="keyword">from</span> <span class="string">"./lang/zh"</span>;</span><br><span class="line"><span class="keyword">import</span> mEnLocale <span class="keyword">from</span> <span class="string">"./lang/en"</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"@/store"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> messages = &#123;</span><br><span class="line">  en: &#123;</span><br><span class="line">    msg: &#123;</span><br><span class="line">      ...mEnLocale,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  zh: &#123;</span><br><span class="line">    msg: &#123;</span><br><span class="line">      ...mZhLocale,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// vuex管理语言的state</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLanguage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> store &amp;&amp; store.getters &amp;&amp; store.getters.language;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> i18n = createI18n(&#123;</span><br><span class="line">  <span class="comment">// 使用 Composition API 模式，则需要将其设置为false</span></span><br><span class="line">  legacy: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// 全局注入 $t 函数</span></span><br><span class="line">  globalInjection: <span class="literal">true</span>,</span><br><span class="line">  locale: getLanguage(),</span><br><span class="line">  messages,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> i18n;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 <code>main.js</code> 中导入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> i18n <span class="keyword">from</span> <span class="string">"@/i18n"</span>;</span><br><span class="line"></span><br><span class="line">app.use(i18n);</span><br></pre></td></tr></table></figure>
</li>
<li><p>element-puls 语言处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zh <span class="keyword">from</span> <span class="string">"element-plus/es/locale/lang/zh-cn"</span>;</span><br><span class="line"><span class="keyword">import</span> en <span class="keyword">from</span> <span class="string">"element-plus/es/locale/lang/en"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"element-plus/dist/index.css"</span>;</span><br><span class="line">app</span><br><span class="line">  .use(ElementPlus, &#123;</span><br><span class="line">    locale: store.getters.language === <span class="string">"en"</span> ? en : zh,</span><br><span class="line">  &#125;)</span><br><span class="line">  .use(store)</span><br><span class="line">  .use(router)</span><br><span class="line">  .use(i18n)</span><br><span class="line">  .mount(<span class="string">"#app"</span>);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="动态换肤原理"><a href="#动态换肤原理" class="headerlink" title="动态换肤原理"></a>动态换肤原理</h4><blockquote>
<p>动态换肤在实际的后台管理系统项目开发中基本用不到的，只简单讲下实现原理方法。</p>
</blockquote>
<ol>
<li><p>动态换肤的关键是修改 css 变量 的值, vuex 设置全局 css 变量动态棒的。</p>
</li>
<li><p>element-plus 主体变更通过修改 scss 变量 的形式修改主题色完成主题变更。获取 element-plus 所有的 style，更换样式的部分使用正则完成替换。把替换后的样式写入到 style 标签中。</p>
</li>
<li><p><a href="https://www.npmjs.com/package/rgb-hex" target="_blank" rel="noopener">rgb-hex</a>：转换 RGB(A)颜色为十六进制</p>
</li>
<li><a href="https://www.npmjs.com/package/css-color-function" target="_blank" rel="noopener">css-color-function</a>：在 CSS 中提出的颜色函数的解析器和转换器</li>
</ol>
<h4 id="页面全屏"><a href="#页面全屏" class="headerlink" title="页面全屏"></a>页面全屏</h4><blockquote>
<p>浏览器本身已经提供 API,Document.exitFullscreen()和 Element.requestFullscreen()，但有一定的小问题，比如 appmain 区域背景颜色为黑色。</p>
</blockquote>
<ol>
<li><p>screenfull</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i screenfull@5.1.0</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建 <code>components/Screenfull/index</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;svg-icon</span><br><span class="line">      :icon=&quot;isFullscreen ? &apos;exit-fullscreen&apos; : &apos;fullscreen&apos;&quot;</span><br><span class="line">      @click=&quot;onToggle&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, onMounted, onUnmounted &#125; from &quot;vue&quot;;</span><br><span class="line">import screenfull from &quot;screenfull&quot;;</span><br><span class="line"></span><br><span class="line">// 是否全屏</span><br><span class="line">const isFullscreen = ref(false);</span><br><span class="line"></span><br><span class="line">// 监听变化</span><br><span class="line">const change = () =&gt; &#123;</span><br><span class="line">  isFullscreen.value = screenfull.isFullscreen;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 切换事件</span><br><span class="line">const onToggle = () =&gt; &#123;</span><br><span class="line">  screenfull.toggle();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 设置侦听器</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  screenfull.on(&quot;change&quot;, change);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 删除侦听器</span><br><span class="line">onUnmounted(() =&gt; &#123;</span><br><span class="line">  screenfull.off(&quot;change&quot;, change);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="headerSearch-原理及方案分析"><a href="#headerSearch-原理及方案分析" class="headerlink" title="headerSearch 原理及方案分析"></a>headerSearch 原理及方案分析</h4><blockquote>
<p>指定搜索框中对当前应用中所有页面进行检索，以 select 的形式展示出被检索的页面，以达到快速进入的目的</p>
</blockquote>
<ol>
<li>获取所有的页面数据，用作被检索的数据源</li>
<li><p>根据用户输入内容在数据源中进行模糊搜索</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save fuse.js</span><br></pre></td></tr></table></figure>
</li>
<li><p>把搜索到的内容以 <code>select</code> 进行展示</p>
</li>
<li>监听 <code>select</code> 的 <code>change</code> 事件，完成对应跳转</li>
</ol>
<h4 id="tabsView"><a href="#tabsView" class="headerlink" title="tabsView"></a>tabsView</h4><ol>
<li><p>监听路由的变化，获取路由的数据</p>
</li>
<li><p>右键根据不同类型处理展示数据</p>
</li>
</ol>
<p>/TagsView/ContextMenu.vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;ul class=&quot;context-menu-container&quot;&gt;</span><br><span class="line">    &lt;li @click=&quot;onRefreshClick&quot;&gt;</span><br><span class="line">      &#123;&#123; $t(&quot;msg.tagsView.refresh&quot;) &#125;&#125;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li @click=&quot;onCloseRightClick&quot;&gt;</span><br><span class="line">      &#123;&#123; $t(&quot;msg.tagsView.closeRight&quot;) &#125;&#125;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li @click=&quot;onCloseOtherClick&quot;&gt;</span><br><span class="line">      &#123;&#123; $t(&quot;msg.tagsView.closeOther&quot;) &#125;&#125;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; defineProps &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; useRouter &#125; from &quot;vue-router&quot;;</span><br><span class="line">import &#123; useStore &#125; from &quot;vuex&quot;;</span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  index: &#123;</span><br><span class="line">    type: Number,</span><br><span class="line">    required: true,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const router = useRouter();</span><br><span class="line">const onRefreshClick = () =&gt; &#123;</span><br><span class="line">  router.go(0);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const store = useStore();</span><br><span class="line">const onCloseRightClick = () =&gt; &#123;</span><br><span class="line">  store.commit(&quot;app/removeTagsView&quot;, &#123;</span><br><span class="line">    type: &quot;right&quot;,</span><br><span class="line">    index: props.index,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const onCloseOtherClick = () =&gt; &#123;</span><br><span class="line">  store.commit(&quot;app/removeTagsView&quot;, &#123;</span><br><span class="line">    type: &quot;other&quot;,</span><br><span class="line">    index: props.index,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.context-menu-container &#123;</span><br><span class="line">  position: fixed;</span><br><span class="line">  background: #fff;</span><br><span class="line">  z-index: 3000;</span><br><span class="line">  list-style-type: none;</span><br><span class="line">  padding: 5px 0;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">  font-size: 12px;</span><br><span class="line">  font-weight: 400;</span><br><span class="line">  color: #333;</span><br><span class="line">  box-shadow: 2px 2px 3px 0 rgba(0, 0, 0, 0.3);</span><br><span class="line">  li &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    padding: 7px 16px;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    &amp;:hover &#123;</span><br><span class="line">      background: #eee;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>/TagsView/index.vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;tags-view-container&quot;&gt;</span><br><span class="line">    &lt;el-scrollbar class=&quot;tags-view-wrapper&quot;&gt;</span><br><span class="line">      &lt;router-link</span><br><span class="line">        class=&quot;tags-view-item&quot;</span><br><span class="line">        :class=&quot;isActive(tag) ? &apos;active&apos; : &apos;&apos;&quot;</span><br><span class="line">        :style=&quot;&#123;</span><br><span class="line">          backgroundColor: isActive(tag) ? $store.getters.cssVar.menuBg : &apos;&apos;,</span><br><span class="line">          borderColor: isActive(tag) ? $store.getters.cssVar.menuBg : &apos;&apos;,</span><br><span class="line">        &#125;&quot;</span><br><span class="line">        v-for=&quot;(tag, index) in $store.getters.tagsViewList&quot;</span><br><span class="line">        :key=&quot;tag.fullPath&quot;</span><br><span class="line">        :to=&quot;&#123; path: tag.fullPath &#125;&quot;</span><br><span class="line">        @contextmenu.prevent=&quot;openMenu($event, index)&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;&#123; tag.title &#125;&#125;</span><br><span class="line">        &lt;i</span><br><span class="line">          v-show=&quot;!isActive(tag)&quot;</span><br><span class="line">          class=&quot;el-icon-close&quot;</span><br><span class="line">          @click.prevent.stop=&quot;onCloseClick(index)&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/router-link&gt;</span><br><span class="line">    &lt;/el-scrollbar&gt;</span><br><span class="line">    &lt;context-menu</span><br><span class="line">      v-show=&quot;visible&quot;</span><br><span class="line">      :style=&quot;menuStyle&quot;</span><br><span class="line">      :index=&quot;selectIndex&quot;</span><br><span class="line">    &gt;&lt;/context-menu&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import ContextMenu from &quot;./ContextMenu.vue&quot;;</span><br><span class="line">import &#123; ref, reactive, watch &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; useRoute &#125; from &quot;vue-router&quot;;</span><br><span class="line">import &#123; useStore &#125; from &quot;vuex&quot;;</span><br><span class="line">const route = useRoute();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 是否被选中</span><br><span class="line"> */</span><br><span class="line">const isActive = (tag) =&gt; &#123;</span><br><span class="line">  return tag.path === route.path;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 关闭 tag 的点击事件</span><br><span class="line"> */</span><br><span class="line">const store = useStore();</span><br><span class="line">const onCloseClick = (index) =&gt; &#123;</span><br><span class="line">  store.commit(&quot;app/removeTagsView&quot;, &#123;</span><br><span class="line">    type: &quot;index&quot;,</span><br><span class="line">    index: index,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// contextMenu 相关</span><br><span class="line">const selectIndex = ref(0);</span><br><span class="line">const visible = ref(false);</span><br><span class="line">const menuStyle = reactive(&#123;</span><br><span class="line">  left: 0,</span><br><span class="line">  top: 0,</span><br><span class="line">&#125;);</span><br><span class="line">/**</span><br><span class="line"> * 展示 menu</span><br><span class="line"> */</span><br><span class="line">const openMenu = (e, index) =&gt; &#123;</span><br><span class="line">  const &#123; x, y &#125; = e;</span><br><span class="line">  menuStyle.left = x + &quot;px&quot;;</span><br><span class="line">  menuStyle.top = y + &quot;px&quot;;</span><br><span class="line">  selectIndex.value = index;</span><br><span class="line">  visible.value = true;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 关闭 menu</span><br><span class="line"> */</span><br><span class="line">const closeMenu = () =&gt; &#123;</span><br><span class="line">  visible.value = false;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 监听变化</span><br><span class="line"> */</span><br><span class="line">watch(visible, (val) =&gt; &#123;</span><br><span class="line">  if (val) &#123;</span><br><span class="line">    document.body.addEventListener(&quot;click&quot;, closeMenu);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    document.body.removeEventListener(&quot;click&quot;, closeMenu);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.tags-view-container &#123;</span><br><span class="line">  height: 34px;</span><br><span class="line">  width: 100%;</span><br><span class="line">  background: #fff;</span><br><span class="line">  border-bottom: 1px solid #d8dce5;</span><br><span class="line">  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.12), 0 0 3px 0 rgba(0, 0, 0, 0.04);</span><br><span class="line">  .tags-view-wrapper &#123;</span><br><span class="line">    .tags-view-item &#123;</span><br><span class="line">      display: inline-block;</span><br><span class="line">      position: relative;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">      height: 26px;</span><br><span class="line">      line-height: 26px;</span><br><span class="line">      border: 1px solid #d8dce5;</span><br><span class="line">      color: #495060;</span><br><span class="line">      background: #fff;</span><br><span class="line">      padding: 0 8px;</span><br><span class="line">      font-size: 12px;</span><br><span class="line">      margin-left: 5px;</span><br><span class="line">      margin-top: 4px;</span><br><span class="line">      &amp;:first-of-type &#123;</span><br><span class="line">        margin-left: 15px;</span><br><span class="line">      &#125;</span><br><span class="line">      &amp;:last-of-type &#123;</span><br><span class="line">        margin-right: 15px;</span><br><span class="line">      &#125;</span><br><span class="line">      &amp;.active &#123;</span><br><span class="line">        color: #fff;</span><br><span class="line">        &amp;::before &#123;</span><br><span class="line">          content: &quot;&quot;;</span><br><span class="line">          background: #fff;</span><br><span class="line">          display: inline-block;</span><br><span class="line">          width: 8px;</span><br><span class="line">          height: 8px;</span><br><span class="line">          border-radius: 50%;</span><br><span class="line">          position: relative;</span><br><span class="line">          margin-right: 4px;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      // close 按钮</span><br><span class="line">      .el-icon-close &#123;</span><br><span class="line">        width: 16px;</span><br><span class="line">        height: 16px;</span><br><span class="line">        line-height: 10px;</span><br><span class="line">        vertical-align: 2px;</span><br><span class="line">        border-radius: 50%;</span><br><span class="line">        text-align: center;</span><br><span class="line">        transition: all 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);</span><br><span class="line">        transform-origin: 100% 50%;</span><br><span class="line">        &amp;:before &#123;</span><br><span class="line">          transform: scale(0.6);</span><br><span class="line">          display: inline-block;</span><br><span class="line">          vertical-align: -3px;</span><br><span class="line">        &#125;</span><br><span class="line">        &amp;:hover &#123;</span><br><span class="line">          background-color: #b4bccc;</span><br><span class="line">          color: #fff;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听路由变化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> store = useStore();</span><br><span class="line">watch(</span><br><span class="line">  route,</span><br><span class="line">  (to, <span class="keyword">from</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isTags(to.path)) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">const</span> &#123; fullPath, meta, name, params, path, query &#125; = to;</span><br><span class="line">    store.commit(<span class="string">"app/addTagsViewList"</span>, &#123;</span><br><span class="line">      fullPath,</span><br><span class="line">      meta,</span><br><span class="line">      name,</span><br><span class="line">      params,</span><br><span class="line">      path,</span><br><span class="line">      query,</span><br><span class="line">      title: getTitle(to),</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    immediate: <span class="literal">true</span>,</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; TAGS_VIEW &#125; <span class="keyword">from</span> <span class="string">"@/constant"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getItem, setItem &#125; <span class="keyword">from</span> <span class="string">"@/utils/storage"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  namespaced: <span class="literal">true</span>,</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    tagsViewList: getItem(TAGS_VIEW) || [],</span><br><span class="line">  &#125;),</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加 tags</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    addTagsViewList(state, tag) &#123;</span><br><span class="line">      <span class="keyword">const</span> isFind = state.tagsViewList.find(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> item.path === tag.path;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// 处理重复</span></span><br><span class="line">      <span class="keyword">if</span> (!isFind) &#123;</span><br><span class="line">        state.tagsViewList.push(tag);</span><br><span class="line">        setItem(TAGS_VIEW, state.tagsViewList);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 为指定的 tag 修改 title</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    changeTagsView(state, &#123; index, tag &#125;) &#123;</span><br><span class="line">      state.tagsViewList[index] = tag;</span><br><span class="line">      setItem(TAGS_VIEW, state.tagsViewList);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除 tag</span></span><br><span class="line"><span class="comment">     * @param &#123;type: 'other'||'right'||'index', index: index&#125; payload</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    removeTagsView(state, payload) &#123;</span><br><span class="line">      <span class="keyword">if</span> (payload.type === <span class="string">"index"</span>) &#123;</span><br><span class="line">        state.tagsViewList.splice(payload.index, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (payload.type === <span class="string">"other"</span>) &#123;</span><br><span class="line">        state.tagsViewList.splice(</span><br><span class="line">          payload.index + <span class="number">1</span>,</span><br><span class="line">          state.tagsViewList.length - payload.index + <span class="number">1</span></span><br><span class="line">        );</span><br><span class="line">        state.tagsViewList.splice(<span class="number">0</span>, payload.index);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (payload.type === <span class="string">"right"</span>) &#123;</span><br><span class="line">        state.tagsViewList.splice(</span><br><span class="line">          payload.index + <span class="number">1</span>,</span><br><span class="line">          state.tagsViewList.length - payload.index + <span class="number">1</span></span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">      setItem(TAGS_VIEW, state.tagsViewList);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="局部打印"><a href="#局部打印" class="headerlink" title="局部打印"></a>局部打印</h4><blockquote>
<p>浏览器右键时，其实可以直接看到对应的 打印 选项，但是这个打印选项是直接打印整个页面，不能指定打印页面中的某一部分的。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vue3-print-nb@0.1.4</span><br></pre></td></tr></table></figure>
<p>然后利用该工具完成下载功能：</p>
<ol>
<li><p>指定 <code>printLoading</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button</span><br><span class="line"> type=&quot;primary&quot;</span><br><span class="line"> :loading=&quot;printLoading&quot;</span><br><span class="line"> &gt;&#123;&#123; $t(&apos;msg.userInfo.print&apos;)&#125;&#125;&lt;/el-button&gt;</span><br><span class="line">// 打印相关</span><br><span class="line">const printLoading = ref(false)</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建打印对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> printObj = &#123;</span><br><span class="line">  <span class="comment">// 打印区域</span></span><br><span class="line">  id: <span class="string">"userInfoBox"</span>,</span><br><span class="line">  <span class="comment">// 打印标题</span></span><br><span class="line">  popTitle: <span class="string">"imooc-vue-element-admin"</span>,</span><br><span class="line">  <span class="comment">// 打印前</span></span><br><span class="line">  beforeOpenCallback(vue) &#123;</span><br><span class="line">    printLoading.value = <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 执行打印</span></span><br><span class="line">  openCallback(vue) &#123;</span><br><span class="line">    printLoading.value = <span class="literal">false</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>指定打印区域 <code>id</code> 匹配</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"userInfoBox"</span> <span class="attr">class</span>=<span class="string">"user-info-box"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>写入如下代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> print <span class="keyword">from</span> <span class="string">"vue3-print-nb"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (app) =&gt; &#123;</span><br><span class="line">  app.use(print);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 <code>main.js</code> 中导入该指令</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> installDirective <span class="keyword">from</span> <span class="string">"@/directives"</span>;</span><br><span class="line">installDirective(app);</span><br></pre></td></tr></table></figure>
</li>
<li><p>将打印指令挂载到 <code>el-button</code> 中</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">v-print</span>=<span class="string">"printObj"</span> <span class="attr">:loading</span>=<span class="string">"printLoading"</span></span></span><br><span class="line"><span class="tag">  &gt;</span>&#123;&#123; $t('msg.userInfo.print') &#125;&#125;<span class="tag">&lt;/<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="RBAC-权限系统"><a href="#RBAC-权限系统" class="headerlink" title="RBAC 权限系统"></a>RBAC 权限系统</h4><blockquote>
<p>基于 角色的权限 控制 用户的访问。员工管理为用户指定角色、通过角色列表为角色指定权限、通过权限列表查看当前项目所有权限。</p>
</blockquote>
<p>permission.js,在 main.js 引入，进行路由权限控制判断，获取当前用户权限菜单进行数据处理整合，最好路由菜单的渲染</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">"./router"</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"./store"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 白名单</span></span><br><span class="line"><span class="keyword">const</span> whiteList = [<span class="string">"/login"</span>];</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 路由前置守卫</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">router.beforeEach(<span class="keyword">async</span> (to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (store.getters.token) &#123;</span><br><span class="line">    <span class="keyword">if</span> (to.path === <span class="string">"/login"</span>) &#123;</span><br><span class="line">      next(<span class="string">"/"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 判断用户资料是否获取</span></span><br><span class="line">      <span class="comment">// 若不存在用户信息，则需要获取用户信息</span></span><br><span class="line">      <span class="keyword">if</span> (!store.getters.hasUserInfo) &#123;</span><br><span class="line">        <span class="comment">// 触发获取用户信息的 action，并获取用户当前权限</span></span><br><span class="line">        <span class="keyword">const</span> &#123; permission &#125; = <span class="keyword">await</span> store.dispatch(<span class="string">"user/getUserInfo"</span>);</span><br><span class="line">        <span class="comment">// 处理用户权限，筛选出需要添加的权限</span></span><br><span class="line">        <span class="keyword">const</span> filterRoutes = <span class="keyword">await</span> store.dispatch(</span><br><span class="line">          <span class="string">"permission/filterRoutes"</span>,</span><br><span class="line">          permission.menus</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// 利用 addRoute 循环添加</span></span><br><span class="line">        filterRoutes.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">          router.addRoute(item);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 添加完动态路由之后，需要在进行一次主动跳转</span></span><br><span class="line">        <span class="keyword">return</span> next(to.path);</span><br><span class="line">      &#125;</span><br><span class="line">      next();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 没有token的情况下，可以进入白名单</span></span><br><span class="line">    <span class="keyword">if</span> (whiteList.indexOf(to.path) &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">      next();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      next(<span class="string">"/login"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 专门处理权限路由的模块,privateRoutes：依据权限进行动态配置的</span></span><br><span class="line"><span class="keyword">import</span> &#123; publicRoutes, privateRoutes &#125; <span class="keyword">from</span> <span class="string">"@/router"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  namespaced: <span class="literal">true</span>,</span><br><span class="line">  state: &#123;</span><br><span class="line">    <span class="comment">// 路由表：初始拥有静态路由权限</span></span><br><span class="line">    routes: publicRoutes,</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 增加路由</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    setRoutes(state, newRoutes) &#123;</span><br><span class="line">      <span class="comment">// 永远在静态路由的基础上增加新路由</span></span><br><span class="line">      state.routes = [...publicRoutes, ...newRoutes];</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据权限筛选路由</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    filterRoutes(context, menus) &#123;</span><br><span class="line">      <span class="keyword">const</span> routes = [];</span><br><span class="line">      <span class="comment">// 路由权限匹配</span></span><br><span class="line">      menus.forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 权限名 与 路由的 name 匹配</span></span><br><span class="line">        routes.push(...privateRoutes.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> item.name === key));</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// 最后添加 不匹配路由进入 404</span></span><br><span class="line">      routes.push(&#123;</span><br><span class="line">        path: <span class="string">"/:catchAll(.*)"</span>,</span><br><span class="line">        redirect: <span class="string">"/404"</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      context.commit(<span class="string">"setRoutes"</span>, routes);</span><br><span class="line">      <span class="keyword">return</span> routes;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="按钮级别权限自定义指令"><a href="#按钮级别权限自定义指令" class="headerlink" title="按钮级别权限自定义指令"></a>按钮级别权限自定义指令</h4><ol>
<li><p>我们期望最终可以通过这样格式的指令进行功能受控 <code>v-permission=&quot;[&#39;importUser&#39;]&quot;</code></p>
</li>
<li><p>以此创建对应的自定义指令 <code>directives/permission</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"@/store"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkPermission</span>(<span class="params">el, binding</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获取绑定的值，此处为权限</span></span><br><span class="line">  <span class="keyword">const</span> &#123; value &#125; = binding;</span><br><span class="line">  <span class="comment">// 获取所有的功能指令</span></span><br><span class="line">  <span class="keyword">const</span> points = store.getters.userInfo.permission.points;</span><br><span class="line">  <span class="comment">// 当传入的指令集为数组时</span></span><br><span class="line">  <span class="keyword">if</span> (value &amp;&amp; value <span class="keyword">instanceof</span> <span class="built_in">Array</span>) &#123;</span><br><span class="line">    <span class="comment">// 匹配对应的指令</span></span><br><span class="line">    <span class="keyword">const</span> hasPermission = points.some(<span class="function">(<span class="params">point</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> value.includes(point);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 如果无法匹配，则表示当前用户无该指令，那么删除对应的功能按钮</span></span><br><span class="line">    <span class="keyword">if</span> (!hasPermission) &#123;</span><br><span class="line">      el.parentNode &amp;&amp; el.parentNode.removeChild(el);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// eslint-disabled-next-line</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'v-permission value is ["admin","editor"]'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 在绑定元素的父组件被挂载后调用</span></span><br><span class="line">  mounted(el, binding) &#123;</span><br><span class="line">    checkPermission(el, binding);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 在包含组件的 VNode 及其子组件的 VNode 更新后调用</span></span><br><span class="line">  update(el, binding) &#123;</span><br><span class="line">    checkPermission(el, binding);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 <code>directives/index</code> 中绑定该指令</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">import</span> permission <span class="keyword">from</span> <span class="string">'./permission'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (app) =&gt; &#123;</span><br><span class="line">  ...</span><br><span class="line">  app.directive(<span class="string">'permission'</span>, permission)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在所有功能中，添加该指令</p>
</li>
<li><p><code>views/role-list/index</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">v-permission</span>=<span class="string">"['distributePermission']"</span>&gt;</span> 删除 <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="动态表格渲染方案"><a href="#动态表格渲染方案" class="headerlink" title="动态表格渲染方案"></a>动态表格渲染方案</h4><blockquote>
<p>展示可勾选的列,动态展示表格的列。通过 v-for 渲染 el-table-column ，当数据改变时 el-table-column 的渲染自然也就发生了变化</p>
</blockquote>
<ol>
<li><p>v-for 渲染所有可勾选的列的列,默认全部勾选，当数据发生变化，通过 watch 监听，filter 得到勾选后变化的列。</p>
</li>
<li><p>table</p>
</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-table</span> <span class="attr">ref</span>=<span class="string">"tableRef"</span> <span class="attr">:data</span>=<span class="string">"tableData"</span> <span class="attr">border</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-table-column</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">"(item, index) in tableColumns"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">"index"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:prop</span>=<span class="string">"item.prop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:label</span>=<span class="string">"item.label"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">"&#123; row &#125;"</span> <span class="attr">v-if</span>=<span class="string">"item.prop === 'publicDate'"</span>&gt;</span> <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">"&#123; row &#125;"</span> <span class="attr">v-else-if</span>=<span class="string">"item.prop === 'action'"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">size</span>=<span class="string">"mini"</span> @<span class="attr">click</span>=<span class="string">"onShowClick(row)"</span></span></span><br><span class="line"><span class="tag">        &gt;</span>查看<span class="tag">&lt;/<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"danger"</span> <span class="attr">size</span>=<span class="string">"mini"</span> @<span class="attr">click</span>=<span class="string">"onRemoveClick(row)"</span></span></span><br><span class="line"><span class="tag">        &gt;</span>删除<span class="tag">&lt;/<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="markdown"><a href="#markdown" class="headerlink" title="markdown"></a>markdown</h4><blockquote>
<p>功能需要满足基本需求,star 在 10K 以上的,作者对该库的维护程度,文档越详尽越好。</p>
</blockquote>
<ol>
<li><code>markdown</code> 编辑器：<ol>
<li><a href="https://github.com/nhn/tui.editor" target="_blank" rel="noopener">tui.editor</a>：<code>Markdown</code> 所见即所得编辑器-高效且可扩展，使用 MIT 开源协议。</li>
<li><a href="https://github.com/lepture/editor" target="_blank" rel="noopener">editor</a>：纯文本 <code>markdown</code> 编辑器</li>
<li><a href="https://github.com/pandao/editor.md" target="_blank" rel="noopener">editor.md</a>：开源可嵌入的在线<code>markdown</code>编辑器(组件)，基于 <code>CodeMirror</code> &amp; <code>jQuery</code> &amp; <code>Marked</code>。国产</li>
<li><a href="https://github.com/adam-p/markdown-here" target="_blank" rel="noopener">markdown-here</a>：谷歌开源，但是已经 <strong>多年不更新</strong> 了</li>
<li><a href="https://github.com/benweet/stackedit" target="_blank" rel="noopener">stackedit</a>：基于<code>PageDown</code>，<code>Stack Overflow</code>和其他 Stack Exchange 站点使用的<code>Markdown</code>库的功能齐全的开源 Markdown 编辑器。<strong>两年未更新了</strong></li>
<li><a href="https://github.com/markdown-it/markdown-it" target="_blank" rel="noopener">markdown-it</a>：可配置语法，可添加、替换规则。<strong>挺长时间未更新了</strong></li>
</ol>
</li>
<li>富文本编辑器：<ol>
<li><a href="https://github.com/wangeditor-team/wangEditor" target="_blank" rel="noopener">wangEditor</a>：国产、文档详尽、更新快速</li>
<li><a href="https://github.com/tinymce/tinymce" target="_blank" rel="noopener">tinymce</a>：对 <code>IE6+</code> 和 <code>Firefox1.5+</code> 都有着非常良好的支持</li>
<li><a href="https://github.com/quilljs/quill" target="_blank" rel="noopener">quill</a>：代码高亮功能、视频加载功能、公式处理比较强。</li>
<li><a href="https://github.com/ckeditor/ckeditor5" target="_blank" rel="noopener">ckeditor5</a>：编辑能力强</li>
<li><a href="https://froala.com/wysiwyg-editor/" target="_blank" rel="noopener">wysiwyg-editor</a>：<strong>收费的</strong> ， 就是牛</li>
</ol>
</li>
</ol>
<h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><ol>
<li><p>下载 <a href="https://github.com/nhn/tui.editor" target="_blank" rel="noopener">tui.editor</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @toast-ui/editor@3.0.2</span><br></pre></td></tr></table></figure>
</li>
<li><p>渲染基本结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;markdown-container&quot;&gt;</span><br><span class="line">    &lt;!-- 渲染区 --&gt;</span><br><span class="line">    &lt;div id=&quot;markdown-box&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123;&#125; from &apos;vue&apos;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.markdown-container &#123;</span><br><span class="line">  .bottom &#123;</span><br><span class="line">    margin-top: 20px;</span><br><span class="line">    text-align: right;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>初始化 <code>editor</code> ，处理国际化内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import MkEditor from &quot;@toast-ui/editor&quot;;</span><br><span class="line">import &quot;@toast-ui/editor/dist/toastui-editor.css&quot;;</span><br><span class="line">import &quot;@toast-ui/editor/dist/i18n/zh-cn&quot;;</span><br><span class="line">import &#123; onMounted &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; useStore &#125; from &quot;vuex&quot;;</span><br><span class="line"></span><br><span class="line">// Editor实例</span><br><span class="line">let mkEditor;</span><br><span class="line">// 处理离开页面切换语言导致 dom 无法被获取</span><br><span class="line">let el;</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  el = document.querySelector(&quot;#markdown-box&quot;);</span><br><span class="line">  initEditor();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const store = useStore();</span><br><span class="line">const initEditor = () =&gt; &#123;</span><br><span class="line">  mkEditor = new MkEditor(&#123;</span><br><span class="line">    el,</span><br><span class="line">    height: &quot;500px&quot;,</span><br><span class="line">    previewStyle: &quot;vertical&quot;,</span><br><span class="line">    language: store.getters.language === &quot;zh&quot; ? &quot;zh-CN&quot; : &quot;en&quot;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  mkEditor.getMarkdown();</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在语言改变时，重置 <code>editor</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; watchSwitchLang &#125; <span class="keyword">from</span> <span class="string">"@/utils/i18n"</span>;</span><br><span class="line"></span><br><span class="line">watchSwitchLang(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!el) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">const</span> htmlStr = mkEditor.getHTML();</span><br><span class="line">  mkEditor.destroy();</span><br><span class="line">  initEditor();</span><br><span class="line">  mkEditor.setHTML(htmlStr);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="wangeditor-富文本"><a href="#wangeditor-富文本" class="headerlink" title="wangeditor 富文本"></a>wangeditor 富文本</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i wangeditor@4.7.6</span><br></pre></td></tr></table></figure>
<p>安装完成之后，我们就去实现对应的代码逻辑：</p>
<ol>
<li><p>创建基本组件结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;editor-container&quot;&gt;</span><br><span class="line">    &lt;div id=&quot;editor-box&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;bottom&quot;&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;onSubmitClick&quot;&gt;&#123;&#123;</span><br><span class="line">        $t(&quot;msg.article.commit&quot;)</span><br><span class="line">      &#125;&#125;&lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123;&#125; from &quot;vue&quot;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.editor-container &#123;</span><br><span class="line">  .bottom &#123;</span><br><span class="line">    margin-top: 20px;</span><br><span class="line">    text-align: right;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>初始化 <code>wangEditor</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import E from &quot;wangeditor&quot;;</span><br><span class="line">import &#123; onMounted &#125; from &quot;vue&quot;;</span><br><span class="line"></span><br><span class="line">// Editor实例</span><br><span class="line">let editor;</span><br><span class="line">// 处理离开页面切换语言导致 dom 无法被获取</span><br><span class="line">let el;</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  el = document.querySelector(&quot;#editor-box&quot;);</span><br><span class="line">  initEditor();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const initEditor = () =&gt; &#123;</span><br><span class="line">  editor = new E(el);</span><br><span class="line">  editor.config.zIndex = 1;</span><br><span class="line">  // 菜单栏提示</span><br><span class="line">  editor.config.showMenuTooltips = true;</span><br><span class="line">  editor.config.menuTooltipPosition = &quot;down&quot;;</span><br><span class="line">  editor.create();</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>wangEditor</code> 的 <a href="https://www.wangeditor.com/doc/pages/12-%E5%A4%9A%E8%AF%AD%E8%A8%80/" target="_blank" rel="noopener">国际化处理</a>，官网支持 <a href="https://www.i18next.com/" target="_blank" rel="noopener">i18next</a>，所以想要处理 <code>wangEditor</code> 的国际化，那么我们需要安装 <a href="https://www.i18next.com/" target="_blank" rel="noopener">i18next</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save i18next@<span class="number">20.4</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>处理提交事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; onMounted, defineProps, defineEmits &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> &#123; commitArticle &#125; <span class="keyword">from</span> <span class="string">'./commit'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = defineProps(&#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    required: <span class="literal">true</span>,</span><br><span class="line">    type: <span class="built_in">String</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emits = defineEmits([<span class="string">'onSuccess'</span>])</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> onSubmitClick = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 创建文章</span></span><br><span class="line">  <span class="keyword">await</span> commitArticle(&#123;</span><br><span class="line">    title: props.title,</span><br><span class="line">    content: editor.txt.html()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  editor.txt.html(<span class="string">''</span>)</span><br><span class="line">  emits(<span class="string">'onSuccess'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>不要忘记在 <code>article-create</code> 中处理对应事件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">editor</span> <span class="attr">:title</span>=<span class="string">"title"</span> <span class="attr">:detail</span>=<span class="string">"detail"</span> @<span class="attr">onSuccess</span>=<span class="string">"onSuccess"</span>&gt;</span><span class="tag">&lt;/<span class="name">editor</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>最后处理编辑</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = defineProps(&#123;</span><br><span class="line">  ...</span><br><span class="line">  detail: &#123;</span><br><span class="line">    type: <span class="built_in">Object</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编辑相关</span></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.detail,</span><br><span class="line">  (val) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (val &amp;&amp; val.content) &#123;</span><br><span class="line">      editor.txt.html(val.content)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    immediate: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> onSubmitClick = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (props.detail &amp;&amp; props.detail._id) &#123;</span><br><span class="line">    <span class="comment">// 编辑文章</span></span><br><span class="line">    <span class="keyword">await</span> editArticle(&#123;</span><br><span class="line">      id: props.detail._id,</span><br><span class="line">      title: props.title,</span><br><span class="line">      content: editor.txt.html()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 创建文章</span></span><br><span class="line">    <span class="keyword">await</span> commitArticle(&#123;</span><br><span class="line">      title: props.title,</span><br><span class="line">      content: editor.txt.html()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  editor.txt.html(<span class="string">''</span>)</span><br><span class="line">  emits(<span class="string">'onSuccess'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/vue/" rel="tag"># vue</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2023/12/26/mysql5/" rel="next" title="SQL优化">
                <i class="fa fa-chevron-left"></i> SQL优化
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2025/07/08/net-core/" rel="prev" title="NetCore开发API基础配置">
                NetCore开发API基础配置 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="刘付鹏" />
            
              <p class="site-author-name" itemprop="name">刘付鹏</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">70</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Vue3-的中后台管理系统基础建设"><span class="nav-number">1.</span> <span class="nav-text">Vue3 的中后台管理系统基础建设</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#vue-cli-创建项目"><span class="nav-number">1.1.</span> <span class="nav-text">vue-cli 创建项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#代码规范"><span class="nav-number">1.2.</span> <span class="nav-text">代码规范</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#eslint"><span class="nav-number">1.2.1.</span> <span class="nav-text">eslint</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#prettier-代码格式化"><span class="nav-number">1.2.2.</span> <span class="nav-text">prettier 代码格式化</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#git-提交规范"><span class="nav-number">1.2.3.</span> <span class="nav-text">git 提交规范</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#svg-组件开发"><span class="nav-number">1.3.</span> <span class="nav-text">svg 组件开发</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#axios-封装"><span class="nav-number">1.4.</span> <span class="nav-text">axios 封装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#面包屑结构数据"><span class="nav-number">1.5.</span> <span class="nav-text">面包屑结构数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#国际化-vue-i18n"><span class="nav-number">1.6.</span> <span class="nav-text">国际化 vue-i18n</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#动态换肤原理"><span class="nav-number">1.7.</span> <span class="nav-text">动态换肤原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#页面全屏"><span class="nav-number">1.8.</span> <span class="nav-text">页面全屏</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#headerSearch-原理及方案分析"><span class="nav-number">1.9.</span> <span class="nav-text">headerSearch 原理及方案分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tabsView"><span class="nav-number">1.10.</span> <span class="nav-text">tabsView</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#局部打印"><span class="nav-number">1.11.</span> <span class="nav-text">局部打印</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RBAC-权限系统"><span class="nav-number">1.12.</span> <span class="nav-text">RBAC 权限系统</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#按钮级别权限自定义指令"><span class="nav-number">1.13.</span> <span class="nav-text">按钮级别权限自定义指令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#动态表格渲染方案"><span class="nav-number">1.14.</span> <span class="nav-text">动态表格渲染方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#markdown"><span class="nav-number">1.15.</span> <span class="nav-text">markdown</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#使用"><span class="nav-number">1.15.1.</span> <span class="nav-text">使用</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#wangeditor-富文本"><span class="nav-number">1.16.</span> <span class="nav-text">wangeditor 富文本</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘付鹏</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
